on:
    push:
    workflow_dispatch:
    pull_request:
        types: [opened, synchronize, reopened, ready_for_review]

name: CD Flatpak

jobs:
    flatpak:
        name: 'Flatpak'
        runs-on: ubuntu-latest
        container:
            image: bilelmoussaoui/flatpak-github-actions:gnome-43
            options: --privileged
        steps:
            - uses: actions/checkout@v2
            - name: Cache
              uses: actions/cache@v3
              with:
                  path: |
                      ~/.cargo/bin/
                      ~/.cargo/registry/index/
                      ~/.cargo/registry/cache/
                      ~/.cargo/git/db/
                  key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}
                  restore-keys: ${{ runner.os }}-cargo-
            - uses: flatpak/flatpak-github-actions/flatpak-builder@v4
              with:
                  bundle: rnote-${{ github.sha }}.flatpak
                  manifest-path: build-aux/com.github.flxzt.rnote.Devel.yaml
